# Architecture

- `canari.generator`: deterministic synthetic token generation.
- `canari.registry`: local SQLite token registry and alert event journal.
- `canari.injector`: token injection helpers.
- `canari.scanner`: deterministic Aho-Corasick output scanner.
- `canari.alerter`: alert dispatch across channels.
- `canari.adapters`: SDK/runnable adapters (OpenAI client patching, runnable wrapping).
- `canari.detection`: exfiltration-pattern assessment for severity classification.
- `canari.monitor`: outbound HTTP egress monitor for canary credential usage.
- `canari.incidents`: conversation-level event correlation and recent incident snapshots.
- `canari.reporting`: forensic summaries and incident timeline reports.
- `canari.exporter`: JSONL/CSV export for SIEM and offline forensics.
- `canari.cli`: operational CLI for stats, incident reports, and exports.
- retention policy: local alert journal can be purged by age.
- operational backup: SQLite DB backup for incident response and archival.
- `canari.rate_limit`: optional in-memory dispatch throttling for alert-noise control.
- `canari.dashboard`: local HTTP dashboard and JSON API for phase-3 visibility.
- `canari.threat_intel`: anonymized local threat-signature feed generation.
- Threat-sharing controls: opt-in toggle, bundle import, network signature catalog, local/network match analysis.
- enterprise support: tenant-aware alert storage and filtering (`tenant_id`).
- multi-app support: application-aware alert attribution/filtering (`application_id`).
- scoped token support: canary tokens can be assigned to tenant/application boundaries.
- dashboard hardening: optional API token gate for `/api/*` endpoints.
- tenant operations: default tenant context for automatic attribution in scans/egress monitors.
- auditability: local immutable-style admin action log (`audit_events`).
- `canari.api`: FastAPI backend for production-style API serving.
- API security: static key or persisted API-key auth from local registry.
- RBAC: `reader` vs `admin` roles, with tenant-scoped readers in API layer.
- API key scopes: optional `tenant_id` and `application_id` constraints are enforced at query layer.
- SIEM integration: outbound normalized/CEF exports and inbound external-event ingestion with local journaling.
- compliance controls: scoped retention policy profiles per tenant/application.
- control-plane portability: export/import bundle for settings, retention profiles, and signature catalog.
- compliance reporting: evidence pack aggregation with controls, operations, and SIEM samples.
- key ops: persisted key rotation and usage tracking (`last_used_at`).
- API operations: admin-only endpoints for key lifecycle management.
